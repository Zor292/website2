<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0"/>
  <title>Live Zone</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet"/>
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    :root{
      --sky:#00c8ff;--sky-dim:rgba(0,200,255,0.07);--sky-glow:rgba(0,200,255,0.15);
      --bg:#050709;--card:#0c1118;--card2:#0f1620;
      --border:#0d2030;--border2:rgba(0,200,255,0.13);
      --text:#e0f4ff;--muted:#4a7a99;--muted2:#2a4a5e;
      --gold:#ffc832;--red:#ff5050;--green:#23a55a;
      --nav-h:60px;
    }
    html,body{height:100%;overflow:hidden;font-family:'Cairo',sans-serif;background:var(--bg);color:var(--text)}

    /* BG */
    .bg-canvas{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
    .bg-aurora{position:absolute;width:160%;height:160%;top:-30%;left:-30%;background:conic-gradient(from 0deg at 50% 50%,transparent 0%,rgba(0,200,255,0.035) 20%,transparent 40%,rgba(0,100,200,0.04) 60%,transparent 80%);animation:aurora 25s linear infinite}
    @keyframes aurora{to{transform:rotate(360deg)}}
    .bg-grid{position:absolute;inset:0;background-image:linear-gradient(rgba(0,200,255,0.02) 1px,transparent 1px),linear-gradient(90deg,rgba(0,200,255,0.02) 1px,transparent 1px);background-size:55px 55px}
    .bg-radial{position:absolute;inset:0;background:radial-gradient(ellipse 70% 50% at 80% 10%,rgba(0,200,255,0.07) 0%,transparent 60%),radial-gradient(ellipse 50% 40% at 10% 80%,rgba(0,120,200,0.05) 0%,transparent 50%)}
    .particle{position:absolute;border-radius:50%;background:rgba(0,200,255,0.3);animation:floatUp linear infinite}
    @keyframes floatUp{0%{transform:translateY(105vh) scale(0);opacity:0}8%{opacity:1}92%{opacity:.25}100%{transform:translateY(-5vh) scale(1.5);opacity:0}}

    /* NAV */
    nav{position:fixed;top:0;left:0;right:0;z-index:200;height:var(--nav-h);display:flex;align-items:center;justify-content:space-between;padding:0 24px;background:rgba(5,7,9,0.93);backdrop-filter:blur(24px);border-bottom:1px solid var(--border2)}
    .nav-logo{font-family:'Rajdhani',sans-serif;font-size:1.35rem;font-weight:700;color:var(--sky);letter-spacing:2px;cursor:pointer;display:flex;align-items:center;gap:8px}
    .nav-dot{width:7px;height:7px;background:var(--sky);border-radius:50%;box-shadow:0 0 8px var(--sky);animation:pulse 2s infinite}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
    .nav-pills{display:flex;gap:2px;list-style:none}
    .nav-pill{padding:6px 13px;border-radius:999px;font-size:.79rem;font-weight:700;cursor:pointer;border:1px solid transparent;color:var(--muted);transition:all .2s}
    .nav-pill:hover,.nav-pill.active{color:var(--sky);background:var(--sky-dim);border-color:var(--border2)}
    .nav-right{display:flex;align-items:center;gap:10px}
    .nav-avatar{width:33px;height:33px;border-radius:50%;border:2px solid var(--border2);object-fit:cover;cursor:pointer;transition:border-color .2s}
    .nav-avatar:hover{border-color:var(--sky)}
    .nav-name{font-size:.81rem;font-weight:700}
    .admin-badge{font-size:.58rem;padding:1px 6px;border-radius:999px;background:rgba(255,80,80,0.12);border:1px solid rgba(255,80,80,0.25);color:#ff8080;font-weight:700}
    .mobile-btn{display:none;background:none;border:1px solid var(--border2);border-radius:7px;padding:5px 9px;color:var(--sky);cursor:pointer;font-size:.95rem}

    /* PAGE SYSTEM */
    .pages-wrapper{position:fixed;top:var(--nav-h);left:0;right:0;bottom:0;overflow:hidden}
    .page{position:absolute;top:0;left:0;right:0;bottom:0;overflow-y:auto;overflow-x:hidden;opacity:0;pointer-events:none;transform:translateY(24px);transition:opacity .4s cubic-bezier(.4,0,.2,1),transform .4s cubic-bezier(.4,0,.2,1);z-index:1}
    .page.active{opacity:1;pointer-events:auto;transform:translateY(0);z-index:2}
    .page.exit{opacity:0;transform:translateY(-24px);z-index:1}
    .page::-webkit-scrollbar{width:4px}
    .page::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px}
    .page-inner{min-height:100%;padding:26px 26px 90px;max-width:1180px;margin:0 auto;position:relative;z-index:1}

    /* PAGE HEADER */
    .page-header{display:flex;align-items:center;gap:14px;margin-bottom:22px;padding-bottom:16px;border-bottom:1px solid var(--border2)}
    .page-icon{width:44px;height:44px;border-radius:12px;background:var(--sky-dim);border:1px solid var(--border2);display:flex;align-items:center;justify-content:center;font-size:1.1rem;flex-shrink:0}
    .page-title{font-size:1.4rem;font-weight:900}
    .page-subtitle{font-size:.75rem;color:var(--muted);margin-top:2px}
    .page-line{flex:1;height:1px;background:linear-gradient(90deg,var(--border2),transparent)}

    /* BOTTOM NAV */
    .page-nav{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);z-index:300;display:flex;align-items:center;gap:10px;background:rgba(8,12,16,0.88);backdrop-filter:blur(20px);border:1px solid var(--border2);border-radius:999px;padding:7px 14px;box-shadow:0 8px 30px rgba(0,0,0,0.5)}
    .pnav-btn{width:36px;height:36px;border-radius:50%;background:var(--sky-dim);border:1px solid var(--border2);color:var(--sky);font-size:1rem;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center}
    .pnav-btn:hover{background:rgba(0,200,255,0.14)}
    .pnav-btn:disabled{opacity:.2;cursor:not-allowed}
    .pnav-dots{display:flex;gap:6px;align-items:center}
    .pnav-dot{width:7px;height:7px;border-radius:50%;background:var(--border2);cursor:pointer;transition:all .22s}
    .pnav-dot.active{background:var(--sky);width:20px;border-radius:3px;box-shadow:0 0 6px var(--sky)}
    .pnav-label{font-size:.73rem;font-weight:700;color:var(--muted);min-width:80px;text-align:center}

    /* SHARED */
    .card{background:var(--card);border:1px solid var(--border);border-radius:15px;transition:border-color .2s}
    .card:hover{border-color:var(--border2)}
    .no-data{color:var(--muted);font-size:.83rem;padding:22px;text-align:center;background:var(--card);border-radius:13px;border:1px solid var(--border)}
    .loading{display:flex;align-items:center;justify-content:center;gap:7px;padding:22px;color:var(--muted);font-size:.82rem}
    .spinner{width:14px;height:14px;border:2px solid var(--border);border-top-color:var(--sky);border-radius:50%;animation:spin .7s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .badge{display:inline-flex;align-items:center;gap:3px;padding:2px 8px;border-radius:999px;font-size:.65rem;font-weight:700;border:1px solid}
    .badge-sky{background:rgba(0,200,255,0.07);border-color:rgba(0,200,255,0.22);color:var(--sky)}
    .badge-red{background:rgba(255,80,80,0.09);border-color:rgba(255,80,80,0.25);color:var(--red)}
    .badge-gold{background:rgba(255,200,50,0.09);border-color:rgba(255,200,50,0.25);color:var(--gold)}
    .form-input{width:100%;background:rgba(255,255,255,0.04);border:1px solid var(--border);border-radius:9px;padding:10px 13px;color:var(--text);font-family:'Cairo',sans-serif;font-size:.84rem;outline:none;transition:border-color .2s}
    .form-input:focus{border-color:var(--sky)}
    .form-input::placeholder{color:var(--muted)}
    .form-textarea{width:100%;background:rgba(255,255,255,0.04);border:1px solid var(--border);border-radius:9px;padding:10px 13px;color:var(--text);font-family:'Cairo',sans-serif;font-size:.84rem;resize:none;outline:none;transition:border-color .2s}
    .form-textarea:focus{border-color:var(--sky)}
    .form-textarea::placeholder{color:var(--muted)}
    .btn-primary{padding:9px 20px;background:var(--sky);border:none;border-radius:9px;color:#000;font-family:'Cairo',sans-serif;font-size:.84rem;font-weight:700;cursor:pointer;transition:all .2s}
    .btn-primary:hover{background:#00aadd}
    .btn-primary:disabled{opacity:.5;cursor:not-allowed}
    .btn-ghost{padding:7px 14px;background:transparent;border:1px solid var(--border);border-radius:8px;color:var(--muted);font-family:'Cairo',sans-serif;font-size:.78rem;font-weight:600;cursor:pointer;transition:all .2s}
    .btn-ghost:hover{border-color:var(--border2);color:var(--sky)}
    .btn-danger{padding:7px 14px;background:rgba(255,80,80,0.08);border:1px solid rgba(255,80,80,0.2);border-radius:8px;color:var(--red);font-family:'Cairo',sans-serif;font-size:.75rem;font-weight:600;cursor:pointer;transition:all .2s}
    .btn-danger:hover{background:rgba(255,80,80,0.15)}

    /* ═══ HOME PAGE ═══ */
    .home-layout{display:grid;grid-template-columns:300px 1fr;gap:18px;align-items:start}
    .profile-card{background:var(--card);border:1px solid var(--border2);border-radius:18px;overflow:hidden}
    .profile-banner{height:76px;background:linear-gradient(135deg,#001020,#002040,rgba(0,200,255,0.2));position:relative;overflow:hidden}
    .profile-banner::after{content:'LIVE ZONE';position:absolute;bottom:8px;left:12px;font-family:'Rajdhani',sans-serif;font-size:.58rem;letter-spacing:3px;color:rgba(0,200,255,0.4);font-weight:700}
    .profile-av-wrap{position:relative;margin:-30px 0 0 13px;display:inline-block}
    .profile-av{width:64px;height:64px;border-radius:50%;border:3px solid var(--card);object-fit:cover;display:block;cursor:pointer}
    .profile-status-dot{position:absolute;bottom:2px;right:1px;width:14px;height:14px;background:var(--green);border-radius:50%;border:3px solid var(--card)}
    .profile-body{padding:7px 14px 16px}
    .profile-name{font-size:1.05rem;font-weight:900;margin-bottom:1px}
    .profile-tag{font-size:.71rem;color:var(--muted);margin-bottom:9px}
    .profile-badges{display:flex;gap:4px;flex-wrap:wrap;margin-bottom:10px}
    .divider-h{height:1px;background:var(--border);margin:9px 0}
    .sec-label{font-size:.58rem;font-weight:700;letter-spacing:1.5px;color:var(--muted);text-transform:uppercase;margin-bottom:7px}
    .roles-list{display:flex;gap:4px;flex-wrap:wrap;margin-bottom:10px}
    .role-tag{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:5px;font-size:.69rem;font-weight:600;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.07)}
    .role-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
    .stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:10px}
    .stat-box{background:rgba(0,200,255,0.04);border:1px solid var(--border2);border-radius:9px;padding:9px;text-align:center}
    .stat-val{font-size:.95rem;font-weight:900;color:var(--sky);font-family:'Rajdhani',sans-serif}
    .stat-lbl{font-size:.61rem;color:var(--muted);margin-top:1px}
    .member-since{font-size:.71rem;color:var(--muted);margin-bottom:11px}
    .btn-logout{display:flex;align-items:center;justify-content:center;gap:6px;width:100%;padding:8px;background:transparent;border:1px solid rgba(255,80,80,0.18);border-radius:9px;color:rgba(255,80,80,0.6);font-family:'Cairo',sans-serif;font-size:.78rem;font-weight:700;cursor:pointer;text-decoration:none;transition:all .2s}
    .btn-logout:hover{background:rgba(255,80,80,0.07);color:var(--red)}

    .hero-card{background:var(--card);border:1px solid var(--border2);border-radius:18px;padding:28px 32px;position:relative;overflow:hidden;margin-bottom:14px}
    .hero-card::before{content:'';position:absolute;top:-50px;left:-50px;width:220px;height:220px;background:radial-gradient(circle,rgba(0,200,255,0.08),transparent 70%);pointer-events:none}
    .hero-title{font-family:'Rajdhani',sans-serif;font-size:1.9rem;font-weight:700;color:var(--sky);letter-spacing:2px;margin-bottom:4px;text-shadow:0 0 20px rgba(0,200,255,0.4)}
    .hero-sub{font-size:.86rem;color:var(--muted);margin-bottom:18px}
    .hero-stats{display:flex;gap:24px}
    .hero-stat-val{font-family:'Rajdhani',sans-serif;font-size:1.4rem;font-weight:700;color:var(--sky)}
    .hero-stat-lbl{font-size:.71rem;color:var(--muted)}
    .quick-nav{display:grid;grid-template-columns:repeat(2,1fr);gap:9px}
    .qnav-card{background:var(--card);border:1px solid var(--border);border-radius:13px;padding:14px;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:11px}
    .qnav-card:hover{border-color:var(--border2);transform:translateY(-2px)}
    .qnav-icon{width:38px;height:38px;background:var(--sky-dim);border:1px solid var(--border2);border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0}
    .qnav-name{font-size:.86rem;font-weight:700}
    .qnav-desc{font-size:.69rem;color:var(--muted);margin-top:1px}

    /* ═══ ANNOUNCEMENTS ═══ */
    .admin-panel{background:rgba(255,80,80,0.03);border:1px solid rgba(255,80,80,0.13);border-radius:14px;padding:18px;margin-bottom:16px;display:none}
    .admin-panel.visible{display:block}
    .admin-panel-title{font-size:.9rem;font-weight:700;color:rgba(255,80,80,0.8);margin-bottom:13px}
    .form-row{display:flex;flex-direction:column;gap:7px;margin-bottom:11px}
    .image-upload-area{border:1px dashed var(--border);border-radius:9px;padding:12px;text-align:center;cursor:pointer;transition:border-color .2s;position:relative}
    .image-upload-area:hover{border-color:var(--border2)}
    .image-upload-area input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%}
    .image-upload-area span{font-size:.78rem;color:var(--muted)}
    .image-preview{max-width:100%;max-height:180px;border-radius:8px;margin-top:8px;display:none}
    .ann-list{display:flex;flex-direction:column;gap:9px}
    .ann-item{background:var(--card);border:1px solid var(--border);border-radius:13px;padding:15px 17px;transition:all .2s;position:relative}
    .ann-item:hover{border-color:var(--border2)}
    .ann-header{display:flex;align-items:center;gap:10px;margin-bottom:8px}
    .ann-icon-wrap{width:36px;height:36px;background:rgba(255,200,50,0.08);border:1px solid rgba(255,200,50,0.15);border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0}
    .ann-title{font-size:.9rem;font-weight:700}
    .ann-text{font-size:.79rem;color:var(--muted);line-height:1.65;white-space:pre-wrap;margin-bottom:6px}
    .ann-img{max-width:100%;border-radius:9px;margin-top:8px;cursor:pointer}
    .ann-date{font-size:.66rem;color:var(--muted2)}
    .ann-del{position:absolute;top:9px;left:9px}

    /* ═══ RULES ═══ */
    .rules-tabs{display:flex;gap:7px;margin-bottom:16px;flex-wrap:wrap}
    .rules-tab{padding:6px 16px;border-radius:999px;font-size:.8rem;font-weight:700;cursor:pointer;border:1px solid var(--border);background:transparent;color:var(--muted);font-family:'Cairo',sans-serif;transition:all .2s}
    .rules-tab.active{background:var(--sky-dim);border-color:var(--border2);color:var(--sky)}
    .rules-panel{display:none}.rules-panel.active{display:flex;flex-direction:column;gap:8px}
    .rule-item{display:flex;gap:13px;align-items:flex-start;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:13px 16px;transition:all .2s}
    .rule-item:hover{border-color:var(--border2);background:var(--card2)}
    .rule-num{width:28px;height:28px;border-radius:7px;background:var(--sky-dim);border:1px solid var(--border2);display:flex;align-items:center;justify-content:center;font-family:'Rajdhani',sans-serif;font-size:.82rem;font-weight:700;color:var(--sky);flex-shrink:0}
    .rule-content{flex:1}
    .rule-title{font-size:.88rem;font-weight:700;margin-bottom:2px}
    .rule-desc{font-size:.78rem;color:var(--muted);line-height:1.65}
    .rule-sev{font-size:.64rem;padding:2px 7px;border-radius:999px;font-weight:700;flex-shrink:0;margin-top:1px}
    .sev-h{background:rgba(255,80,80,0.09);color:var(--red);border:1px solid rgba(255,80,80,0.2)}
    .sev-m{background:rgba(255,170,0,0.09);color:#ffaa00;border:1px solid rgba(255,170,0,0.2)}
    .sev-l{background:rgba(0,200,255,0.09);color:var(--sky);border:1px solid var(--border2)}
    .rules-warn{margin-top:13px;background:rgba(255,80,80,0.05);border:1px solid rgba(255,80,80,0.18);border-radius:11px;padding:12px 15px;font-size:.8rem;color:#ff8080;line-height:1.65}

    /* ═══ RATINGS ═══ */
    .ratings-layout{display:grid;grid-template-columns:280px 1fr;gap:18px;align-items:start}
    .rating-form-card{background:var(--card);border:1px solid var(--border2);border-radius:15px;padding:20px;position:sticky;top:0}
    .rf-title{font-size:.92rem;font-weight:700;color:var(--sky);margin-bottom:12px}
    .form-stars{display:flex;gap:6px;margin-bottom:12px;direction:ltr}
    .form-star{font-size:1.6rem;cursor:pointer;color:var(--muted2);transition:all .15s}
    .form-star:hover,.form-star.sel{color:var(--gold)}
    .form-star:hover{transform:scale(1.15)}
    .btn-submit{margin-top:9px;padding:9px 22px;background:var(--sky);border:none;border-radius:9px;color:#000;font-family:'Cairo',sans-serif;font-size:.85rem;font-weight:700;cursor:pointer;transition:all .2s;width:100%}
    .btn-submit:hover{background:#00aadd}
    .btn-submit:disabled{opacity:.5;cursor:not-allowed}
    .submit-msg{margin-top:8px;font-size:.78rem;padding:7px 11px;border-radius:8px}
    .msg-ok{background:rgba(35,165,90,0.09);color:var(--green);border:1px solid rgba(35,165,90,0.2)}
    .msg-err{background:rgba(255,80,80,0.09);color:var(--red);border:1px solid rgba(255,80,80,0.2)}
    .ratings-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:10px}
    .rating-card{background:var(--card);border:1px solid var(--border);border-radius:13px;padding:15px;position:relative;transition:all .2s}
    .rating-card:hover{border-color:var(--border2);transform:translateY(-2px)}
    .rating-hdr{display:flex;align-items:center;gap:8px;margin-bottom:9px}
    .rating-av{width:36px;height:36px;border-radius:50%;border:2px solid var(--border2);object-fit:cover;cursor:pointer;transition:border-color .2s}
    .rating-av:hover{border-color:var(--sky)}
    .rating-name{font-size:.84rem;font-weight:700}
    .rating-date{font-size:.66rem;color:var(--muted)}
    .stars-row{display:flex;gap:2px;margin-bottom:7px}
    .star-f{color:var(--gold);font-size:.82rem}
    .star-e{color:var(--muted2);font-size:.82rem}
    .rating-text{font-size:.77rem;color:#7aa0b8;line-height:1.6}

    /* ═══ TWITTER ═══ */
    .twitter-layout{display:grid;grid-template-columns:280px 1fr;gap:18px;align-items:start}
    .tweet-compose{background:var(--card);border:1px solid var(--border2);border-radius:15px;padding:18px;position:sticky;top:0}
    .compose-title{font-size:.9rem;font-weight:700;margin-bottom:12px}
    .compose-av{width:38px;height:38px;border-radius:50%;border:2px solid var(--border2);object-fit:cover;flex-shrink:0}
    .compose-row{display:flex;gap:10px;align-items:flex-start;margin-bottom:11px}
    .compose-input{flex:1;background:transparent;border:none;color:var(--text);font-family:'Cairo',sans-serif;font-size:.88rem;resize:none;outline:none;min-height:70px;padding:0}
    .compose-input::placeholder{color:var(--muted)}
    .compose-footer{display:flex;align-items:center;justify-content:space-between;padding-top:10px;border-top:1px solid var(--border)}
    .compose-actions{display:flex;gap:8px;align-items:center}
    .compose-img-btn{background:none;border:none;color:var(--sky);cursor:pointer;font-size:.88rem;padding:4px 8px;border-radius:6px;transition:background .2s;font-family:'Cairo',sans-serif}
    .compose-img-btn:hover{background:var(--sky-dim)}
    .char-count{font-size:.73rem;color:var(--muted)}
    .compose-preview{width:100%;border-radius:10px;margin-bottom:10px;display:none;position:relative}
    .compose-preview img{width:100%;border-radius:10px;max-height:180px;object-fit:cover}
    .compose-preview-rm{position:absolute;top:6px;right:6px;background:rgba(0,0,0,0.7);border:none;border-radius:50%;width:24px;height:24px;color:white;cursor:pointer;font-size:.8rem}
    .tweet-feed{display:flex;flex-direction:column;gap:10px}
    .tweet-card{background:var(--card);border:1px solid var(--border);border-radius:13px;padding:16px;transition:all .2s;cursor:pointer;position:relative}
    .tweet-card:hover{border-color:var(--border2)}
    .tweet-hdr{display:flex;align-items:center;gap:9px;margin-bottom:10px}
    .tweet-av{width:40px;height:40px;border-radius:50%;border:2px solid var(--border2);object-fit:cover;flex-shrink:0;cursor:pointer;transition:border-color .2s}
    .tweet-av:hover{border-color:var(--sky)}
    .tweet-name{font-size:.88rem;font-weight:700}
    .tweet-handle{font-size:.72rem;color:var(--muted)}
    .tweet-time{font-size:.68rem;color:var(--muted2);margin-right:auto}
    .tweet-content{font-size:.86rem;line-height:1.65;margin-bottom:10px;word-break:break-word}
    .tweet-img{width:100%;border-radius:10px;margin-bottom:10px;max-height:300px;object-fit:cover;cursor:pointer}
    .tweet-actions{display:flex;gap:16px;align-items:center;padding-top:9px;border-top:1px solid var(--border)}
    .tweet-action{display:flex;align-items:center;gap:5px;cursor:pointer;font-size:.78rem;color:var(--muted);border:none;background:none;font-family:'Cairo',sans-serif;transition:color .15s;padding:4px 7px;border-radius:6px}
    .tweet-action:hover{background:var(--sky-dim);color:var(--sky)}
    .tweet-action.liked{color:var(--red)}
    .tweet-action.liked:hover{color:var(--red)}
    .tweet-action.reposted{color:var(--green)}
    .tweet-action.reposted:hover{color:var(--green)}
    .tweet-del-btn{position:absolute;top:10px;left:10px;display:none}
    .repost-badge{font-size:.65rem;color:var(--green);display:flex;align-items:center;gap:4px;margin-bottom:6px}
    /* Comments section */
    .comments-section{margin-top:12px;padding-top:12px;border-top:1px solid var(--border);display:none}
    .comments-section.open{display:block}
    .comment-compose{display:flex;gap:8px;align-items:flex-start;margin-bottom:10px}
    .comment-av{width:30px;height:30px;border-radius:50%;object-fit:cover;border:1px solid var(--border2);flex-shrink:0}
    .comment-input{flex:1;background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:8px;padding:7px 10px;color:var(--text);font-family:'Cairo',sans-serif;font-size:.79rem;outline:none;transition:border-color .2s;resize:none;min-height:38px}
    .comment-input:focus{border-color:var(--sky)}
    .comment-input::placeholder{color:var(--muted)}
    .btn-comment{padding:6px 14px;background:var(--sky);border:none;border-radius:7px;color:#000;font-family:'Cairo',sans-serif;font-size:.75rem;font-weight:700;cursor:pointer;white-space:nowrap;margin-top:2px}
    .comment-list{display:flex;flex-direction:column;gap:7px}
    .comment-item{display:flex;gap:8px;align-items:flex-start}
    .comment-body{flex:1;background:rgba(255,255,255,0.02);border-radius:9px;padding:8px 10px}
    .comment-name{font-size:.78rem;font-weight:700;margin-bottom:2px}
    .comment-text{font-size:.77rem;color:var(--muted);line-height:1.55}

    /* ═══ RP POSITIONS ═══ */
    .rp-grid{display:flex;flex-direction:column;gap:14px}
    .rp-group{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;transition:border-color .2s}
    .rp-group:hover{border-color:var(--border2)}
    .rp-gh{padding:13px 18px;display:flex;align-items:center;gap:11px;border-bottom:1px solid var(--border)}
    .rp-gn{font-size:.94rem;font-weight:700}
    .rp-gc{font-size:.68rem;padding:2px 8px;border-radius:999px;font-weight:700;background:rgba(0,200,255,0.07);border:1px solid var(--border2);color:var(--sky);margin-right:auto}
    .rp-members-grid{padding:13px 15px;display:grid;grid-template-columns:repeat(auto-fill,minmax(105px,1fr));gap:8px}
    .rp-member{display:flex;flex-direction:column;align-items:center;gap:5px;padding:11px 8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);border-radius:10px;transition:all .2s;cursor:pointer}
    .rp-member:hover{background:rgba(0,200,255,0.04);border-color:var(--border2)}
    .rp-av{width:44px;height:44px;border-radius:50%;border:2px solid rgba(255,255,255,0.1);object-fit:cover}
    .rp-nm{font-size:.73rem;font-weight:600;text-align:center;word-break:break-word}
    .rp-empty{padding:14px;text-align:center;color:var(--muted);font-size:.79rem}
    .rp-footer{font-size:.66rem;color:var(--muted2);padding:7px 15px;border-top:1px solid var(--border);display:flex;justify-content:space-between}

    /* ═══ STAFF ═══ */
    .staff-tier{margin-bottom:24px}
    .tier-header{display:flex;align-items:center;gap:10px;margin-bottom:12px}
    .tier-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
    .tier-name{font-size:.88rem;font-weight:700}
    .tier-line{flex:1;height:1px;background:linear-gradient(90deg,var(--border2),transparent)}
    .staff-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px}
    .staff-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px 13px;text-align:center;transition:all .2s;cursor:pointer}
    .staff-card:hover{border-color:var(--border2);transform:translateY(-2px)}
    .staff-av{width:54px;height:54px;border-radius:50%;border:2px solid var(--border2);margin:0 auto 9px;display:block;object-fit:cover;transition:border-color .2s}
    .staff-card:hover .staff-av{border-color:var(--sky)}
    .staff-name{font-size:.83rem;font-weight:700;margin-bottom:3px}
    .staff-role{font-size:.68rem;font-weight:600}

    /* ═══ PROFILE POPUP ═══ */
    .popup-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);backdrop-filter:blur(6px);z-index:500;display:none;align-items:center;justify-content:center}
    .popup-overlay.open{display:flex}
    .profile-popup{background:#0a0e14;border:1px solid var(--border2);border-radius:18px;width:340px;max-height:85vh;overflow-y:auto;animation:popIn .25s ease}
    @keyframes popIn{from{opacity:0;transform:scale(.93)}to{opacity:1;transform:scale(1)}}
    .profile-popup::-webkit-scrollbar{width:3px}
    .profile-popup::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
    .popup-banner{height:80px;border-radius:17px 17px 0 0;position:relative;overflow:hidden}
    .popup-banner-img{width:100%;height:100%;object-fit:cover}
    .popup-banner-default{width:100%;height:100%;background:linear-gradient(135deg,#001020,#002244,rgba(0,200,255,0.25))}
    .popup-close{position:absolute;top:8px;left:8px;width:26px;height:26px;background:rgba(0,0,0,0.6);border:none;border-radius:50%;color:white;cursor:pointer;font-size:.85rem;display:flex;align-items:center;justify-content:center}
    .popup-av-wrap{position:relative;margin:-32px 0 0 14px;display:inline-block}
    .popup-av{width:66px;height:66px;border-radius:50%;border:3px solid #0a0e14;object-fit:cover;display:block}
    .popup-body{padding:8px 16px 18px}
    .popup-name{font-size:1.05rem;font-weight:900;margin-bottom:1px}
    .popup-tag{font-size:.71rem;color:var(--muted);margin-bottom:9px}
    .popup-badges{display:flex;gap:4px;flex-wrap:wrap;margin-bottom:11px}
    .popup-roles{display:flex;gap:4px;flex-wrap:wrap;margin-bottom:11px}
    .popup-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;margin-bottom:11px}
    .popup-stat{background:rgba(0,200,255,0.04);border:1px solid var(--border2);border-radius:9px;padding:8px;text-align:center}
    .popup-stat-val{font-size:.88rem;font-weight:900;color:var(--sky);font-family:'Rajdhani',sans-serif}
    .popup-stat-lbl{font-size:.59rem;color:var(--muted);margin-top:1px}
    .popup-joined{font-size:.7rem;color:var(--muted);padding-top:10px;border-top:1px solid var(--border)}

    /* IMAGE LIGHTBOX */
    .lightbox{position:fixed;inset:0;background:rgba(0,0,0,0.92);z-index:600;display:none;align-items:center;justify-content:center;cursor:zoom-out}
    .lightbox.open{display:flex}
    .lightbox img{max-width:90vw;max-height:90vh;border-radius:10px;object-fit:contain}

    /* MOBILE NAV */
    .mobile-nav-overlay{display:none;position:fixed;top:var(--nav-h);right:0;left:0;background:rgba(5,7,9,0.97);backdrop-filter:blur(20px);border-bottom:1px solid var(--border2);z-index:199;padding:11px 14px;flex-direction:column;gap:3px}
    .mobile-nav-overlay.open{display:flex}
    .mobile-nav-overlay a,.mobile-nav-overlay button{display:block;padding:10px 14px;color:var(--muted);text-decoration:none;font-size:.88rem;font-weight:600;border-radius:9px;transition:all .2s;background:none;border:none;font-family:'Cairo',sans-serif;cursor:pointer;width:100%;text-align:right}
    .mobile-nav-overlay a:hover,.mobile-nav-overlay button:hover{color:var(--sky);background:var(--sky-dim)}

    @media(max-width:900px){.home-layout,.twitter-layout,.ratings-layout{grid-template-columns:1fr}}
    @media(max-width:700px){
      nav{padding:0 13px}
      .nav-pills{display:none}
      .nav-name{display:none}
      .mobile-btn{display:block}
      .page-inner{padding:18px 13px 90px}
      .staff-grid{grid-template-columns:repeat(3,1fr)}
      .rp-members-grid{grid-template-columns:repeat(auto-fill,minmax(88px,1fr))}
      .pnav-label{display:none}
    }
  </style>
</head>
<body>

<!-- BG -->
<div class="bg-canvas">
  <div class="bg-aurora"></div>
  <div class="bg-grid"></div>
  <div class="bg-radial"></div>
  <div id="bgParticles"></div>
</div>

<!-- NAV -->
<nav>
  <div class="nav-logo" onclick="goToPage(0)"><div class="nav-dot"></div> LIVE ZONE</div>
  <ul class="nav-pills" id="navPills">
    <li class="nav-pill active" onclick="goToPage(0)">الرئيسية</li>
    <li class="nav-pill" onclick="goToPage(1)">الاعلانات</li>
    <li class="nav-pill" onclick="goToPage(2)">القوانين</li>
    <li class="nav-pill" onclick="goToPage(3)">التقييمات</li>
    <li class="nav-pill" onclick="goToPage(4)">تويتر</li>
    <li class="nav-pill" onclick="goToPage(5)">مناصب RP</li>
    <li class="nav-pill" onclick="goToPage(6)">الفريق</li>
  </ul>
  <div class="nav-right">
    <button class="mobile-btn" onclick="toggleMobileNav()">&#9776;</button>
    <img class="nav-avatar" id="navAvatar" src="https://cdn.discordapp.com/embed/avatars/0.png" onclick="openMyProfile()"/>
    <span class="nav-name" id="navName">...</span>
    <span class="admin-badge" id="adminBadgeNav" style="display:none">ادمن</span>
  </div>
</nav>

<!-- MOBILE NAV -->
<div class="mobile-nav-overlay" id="mobileNav">
  <button onclick="goToPage(0);toggleMobileNav()">الرئيسية</button>
  <button onclick="goToPage(1);toggleMobileNav()">الاعلانات</button>
  <button onclick="goToPage(2);toggleMobileNav()">القوانين</button>
  <button onclick="goToPage(3);toggleMobileNav()">التقييمات</button>
  <button onclick="goToPage(4);toggleMobileNav()">تويتر</button>
  <button onclick="goToPage(5);toggleMobileNav()">مناصب RP</button>
  <button onclick="goToPage(6);toggleMobileNav()">الفريق</button>
  <a href="/auth/logout">تسجيل الخروج</a>
</div>

<!-- PAGES -->
<div class="pages-wrapper">

  <!-- PAGE 0: HOME -->
  <div class="page active" id="page-0">
    <div class="page-inner">
      <div class="home-layout">
        <div>
          <div class="profile-card">
            <div class="profile-banner"></div>
            <div class="profile-av-wrap">
              <img class="profile-av" id="profileAvatar" src="https://cdn.discordapp.com/embed/avatars/0.png" onclick="openMyProfile()"/>
              <div class="profile-status-dot"></div>
            </div>
            <div class="profile-body">
              <div class="profile-name" id="profileName">جار التحميل...</div>
              <div class="profile-tag" id="profileTag">@...</div>
              <div class="profile-badges" id="profileBadges"></div>
              <div class="divider-h"></div>
              <div class="sec-label">رتبك في السيرفر</div>
              <div class="roles-list" id="rolesList"><div class="loading"><div class="spinner"></div></div></div>
              <div class="divider-h"></div>
              <div class="sec-label">الاحصائيات</div>
              <div class="stats-grid">
                <div class="stat-box"><div class="stat-val" id="statId">—</div><div class="stat-lbl">آخر 4 أرقام</div></div>
                <div class="stat-box"><div class="stat-val" id="statDays">—</div><div class="stat-lbl">يوم عضوية</div></div>
                <div class="stat-box"><div class="stat-val">نشط</div><div class="stat-lbl">الحالة</div></div>
                <div class="stat-box"><div class="stat-val" id="statType">—</div><div class="stat-lbl">النوع</div></div>
              </div>
              <div class="member-since" id="memberSince">عضو منذ ...</div>
              <a href="/auth/logout" class="btn-logout">تسجيل الخروج</a>
            </div>
          </div>
        </div>
        <div>
          <div class="hero-card">
            <div class="hero-title">LIVE ZONE</div>
            <div class="hero-sub">السيرفر الأول للترفيه والرول بلاي</div>
            <div class="hero-stats">
              <div><div class="hero-stat-val" id="memberCount">—</div><div class="hero-stat-lbl">عضو</div></div>
              <div><div class="hero-stat-val" id="onlineCount">—</div><div class="hero-stat-lbl">أونلاين</div></div>
              <div><div class="hero-stat-val">24/7</div><div class="hero-stat-lbl">نشاط</div></div>
            </div>
          </div>
          <div class="quick-nav">
            <div class="qnav-card" onclick="goToPage(1)"><div class="qnav-icon">&#128226;</div><div><div class="qnav-name">الاعلانات</div><div class="qnav-desc">آخر أخبار السيرفر</div></div></div>
            <div class="qnav-card" onclick="goToPage(4)"><div class="qnav-icon">&#128483;</div><div><div class="qnav-name">تويتر</div><div class="qnav-desc">تغريدات الأعضاء</div></div></div>
            <div class="qnav-card" onclick="goToPage(3)"><div class="qnav-icon">&#11088;</div><div><div class="qnav-name">التقييمات</div><div class="qnav-desc">آراء الأعضاء</div></div></div>
            <div class="qnav-card" onclick="goToPage(5)"><div class="qnav-icon">&#127918;</div><div><div class="qnav-name">مناصب RP</div><div class="qnav-desc">الأعضاء بالرتب</div></div></div>
            <div class="qnav-card" onclick="goToPage(6)"><div class="qnav-icon">&#128081;</div><div><div class="qnav-name">الفريق الاداري</div><div class="qnav-desc">المسؤولون</div></div></div>
            <div class="qnav-card" onclick="goToPage(2)"><div class="qnav-icon">&#128203;</div><div><div class="qnav-name">القوانين</div><div class="qnav-desc">قواعد السيرفر</div></div></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PAGE 1: ANNOUNCEMENTS -->
  <div class="page" id="page-1">
    <div class="page-inner">
      <div class="page-header">
        <div class="page-icon">&#128226;</div>
        <div><div class="page-title">الاعلانات</div><div class="page-subtitle">آخر أخبار وتحديثات السيرفر</div></div>
        <div class="page-line"></div>
      </div>
      <div class="admin-panel" id="adminAnnPanel">
        <div class="admin-panel-title">نشر اعلان جديد</div>
        <div class="form-row">
          <input class="form-input" id="annIcon" placeholder="رمز (اختياري)" maxlength="4" style="width:90px"/>
          <input class="form-input" id="annTitle" placeholder="العنوان *" maxlength="100"/>
          <textarea class="form-textarea" id="annContent" placeholder="محتوى الاعلان *" maxlength="1000" style="min-height:80px"></textarea>
          <div class="image-upload-area" id="annImageArea">
            <input type="file" accept="image/*" id="annImageInput" onchange="handleAnnImage(this)"/>
            <span id="annImageLabel">ارفاق صورة (اختياري)</span>
          </div>
          <img id="annImagePreview" class="image-preview"/>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn-primary" onclick="postAnnouncement()">نشر</button>
          <span id="annMsg" style="font-size:.77rem"></span>
        </div>
      </div>
      <div class="ann-list" id="announcementsList"><div class="loading"><div class="spinner"></div> جار التحميل...</div></div>
    </div>
  </div>

  <!-- PAGE 2: RULES -->
  <div class="page" id="page-2">
    <div class="page-inner">
      <div class="page-header">
        <div class="page-icon">&#128203;</div>
        <div><div class="page-title">قوانين السيرفر</div><div class="page-subtitle">يرجى الالتزام بجميع القوانين</div></div>
        <div class="page-line"></div>
      </div>
      <div class="rules-tabs">
        <button class="rules-tab active" onclick="switchTab('discord')">قوانين ديسكورد</button>
        <button class="rules-tab" onclick="switchTab('rp')">قوانين الرول بلاي</button>
        <button class="rules-tab" onclick="switchTab('hamburg')">قوانين هامبرغ</button>
      </div>
      <div id="tab-discord" class="rules-panel active">
        <div class="rule-item"><div class="rule-num">1</div><div class="rule-content"><div class="rule-title">الاحترام المتبادل</div><div class="rule-desc">يمنع منعاً باتاً الاساءة اللفظية أو التنمر أو الاهانة تجاه أي عضو داخل السيرفر</div></div><span class="rule-sev sev-h">عالي</span></div>
        <div class="rule-item"><div class="rule-num">2</div><div class="rule-content"><div class="rule-title">حظر السبام</div><div class="rule-desc">يمنع ارسال رسائل متكررة أو روابط غير مرغوب فيها في القنوات</div></div><span class="rule-sev sev-m">متوسط</span></div>
        <div class="rule-item"><div class="rule-num">3</div><div class="rule-content"><div class="rule-title">المحتوى الملائم</div><div class="rule-desc">يمنع نشر محتوى +18 أو صور فاضحة خارج القنوات المخصصة لذلك</div></div><span class="rule-sev sev-h">عالي</span></div>
        <div class="rule-item"><div class="rule-num">4</div><div class="rule-content"><div class="rule-title">حظر الاعلانات</div><div class="rule-desc">لا تشارك روابط سيرفرات أخرى أو أي اعلانات بدون اذن من الادارة</div></div><span class="rule-sev sev-m">متوسط</span></div>
        <div class="rule-item"><div class="rule-num">5</div><div class="rule-content"><div class="rule-title">اتباع تعليمات الادارة</div><div class="rule-desc">يجب احترام قرارات المشرفين والادارة في جميع الاوقات دون جدال</div></div><span class="rule-sev sev-l">منخفض</span></div>
        <div class="rule-item"><div class="rule-num">6</div><div class="rule-content"><div class="rule-title">استخدام القنوات بشكل صحيح</div><div class="rule-desc">يجب استخدام كل قناة للغرض المخصص لها وعدم الخروج عن موضوعها</div></div><span class="rule-sev sev-l">منخفض</span></div>
        <div class="rules-warn">مخالفة القوانين تؤدي إلى: تحذير ← كتم ← طرد ← حظر دائم</div>
      </div>
      <div id="tab-rp" class="rules-panel">
        <div class="rule-item"><div class="rule-num">1</div><div class="rule-content"><div class="rule-title">الالتزام بالشخصية</div><div class="rule-desc">يجب الالتزام بشخصيتك داخل السيرفر ولا يجوز الخروج منها إلا في مناطق OOC المحددة</div></div><span class="rule-sev sev-h">عالي</span></div>
        <div class="rule-item"><div class="rule-num">2</div><div class="rule-content"><div class="rule-title">حظر NLR</div><div class="rule-desc">بعد وفاة شخصيتك لا يجوز العودة للمنطقة ذاتها لمدة 15 دقيقة من وقت الوفاة</div></div><span class="rule-sev sev-h">عالي</span></div>
        <div class="rule-item"><div class="rule-num">3</div><div class="rule-content"><div class="rule-title">حظر Metagaming</div><div class="rule-desc">يمنع استخدام معلومات حصلت عليها خارج الرول بلاي داخل اللعبة</div></div><span class="rule-sev sev-h">عالي</span></div>
        <div class="rule-item"><div class="rule-num">4</div><div class="rule-content"><div class="rule-title">VDM و RDM</div><div class="rule-desc">يمنع قتل أو دهس الاشخاص بدون سبب رول بلاي منطقي ومقبول</div></div><span class="rule-sev sev-h">عالي</span></div>
        <div class="rule-item"><div class="rule-num">5</div><div class="rule-content"><div class="rule-title">احترام الجميع</div><div class="rule-desc">يجب احترام اللعبة وجميع اللاعبين سواء مدنيين أو رجال قانون أو مجرمين</div></div><span class="rule-sev sev-m">متوسط</span></div>
        <div class="rule-item"><div class="rule-num">6</div><div class="rule-content"><div class="rule-title">الهروب من الرول</div><div class="rule-desc">يمنع الخروج من الرول بلاي في أي موقف اعتقال أو مطاردة أو أي موقف آخر</div></div><span class="rule-sev sev-h">عالي</span></div>
      </div>
      <div id="tab-hamburg" class="rules-panel">
        <div class="rule-item"><div class="rule-num">1</div><div class="rule-content"><div class="rule-title">التيزر والسلاح</div><div class="rule-desc">يمنع تتيزر شخص في حال كان معه سلاح ناري أو أبيض، ويسمح فقط في حال لم يكن معه أي سلاح</div></div><span class="rule-sev sev-h">عالي</span></div>
        <div class="rule-item"><div class="rule-num">2</div><div class="rule-content"><div class="rule-title">الكلبشة والاستسلام</div><div class="rule-desc">يمنع تكلبش الشخص وهو ساقط إذا قام بتسليم نفسه وتيزره مسبقاً</div></div><span class="rule-sev sev-h">عالي</span></div>
        <div class="rule-item"><div class="rule-num">3</div><div class="rule-content"><div class="rule-title">المواجهة والمقاومة</div><div class="rule-desc">في حال كنت لوحدك ومعك سلاح ناري ورفع عليك شخص واحد السلاح يمكنك المقاومة. أما إذا كانوا أكثر من شخص فيمنع المقاومة ويجب تسليم نفسك</div></div><span class="rule-sev sev-h">عالي</span></div>
        <div class="rule-item"><div class="rule-num">4</div><div class="rule-content"><div class="rule-title">قوانين الاعدام</div><div class="rule-desc">يجب أن تكون بينك وبين الشخص عداوة لا تقل عن يومين. اعدام العساكر فقط من القاضي. اعدام المجرمين يكون في مكان بعيد وخالي من المباني والسكان</div></div><span class="rule-sev sev-h">عالي</span></div>
        <div class="rule-item"><div class="rule-num">5</div><div class="rule-content"><div class="rule-title">تحرير المدن</div><div class="rule-desc">في حال تحرير مدينة يمنع احتلالها مرة أخرى إلا بعد 3 أيام، ويجب أن يكون عدد المجرمين قريباً من عدد العساكر ويصير فايت على المدينة</div></div><span class="rule-sev sev-m">متوسط</span></div>
        <div class="rule-item"><div class="rule-num">6</div><div class="rule-content"><div class="rule-title">الخروج من الرول</div><div class="rule-desc">في حال انمسكت من الشرطة أو انخطفت يمنع الخروج من الرول بأي حال من الاحوال</div></div><span class="rule-sev sev-h">عالي</span></div>
        <div class="rule-item"><div class="rule-num">7</div><div class="rule-content"><div class="rule-title">المداهمات</div><div class="rule-desc">مداهمة المركز تتطلب عدداً لا يقل عن 4 مجرمين. البنك 3 أشخاص فما فوق</div></div><span class="rule-sev sev-m">متوسط</span></div>
        <div class="rule-item"><div class="rule-num">8</div><div class="rule-content"><div class="rule-title">احترام الرتب</div><div class="rule-desc">يجب احترام الرتب العليا والاستماع لتوجيهاتها في جميع الاوقات</div></div><span class="rule-sev sev-l">منخفض</span></div>
        <div class="rule-item"><div class="rule-num">9</div><div class="rule-content"><div class="rule-title">قرار القاضي والحصانة</div><div class="rule-desc">يجب احترام قرار القاضي وتنفيذه. للقاضي حصانة تنفك فقط إذا باشر الميدان بنفسه</div></div><span class="rule-sev sev-m">متوسط</span></div>
        <div class="rule-item"><div class="rule-num">10</div><div class="rule-content"><div class="rule-title">حظر حشر الريسبون</div><div class="rule-desc">يمنع انتظار شخص يتحلل ثم مسكه أو خطفه فور ما يترسبن في المستشفى</div></div><span class="rule-sev sev-h">عالي</span></div>
      </div>
    </div>
  </div>

  <!-- PAGE 3: RATINGS -->
  <div class="page" id="page-3">
    <div class="page-inner">
      <div class="page-header">
        <div class="page-icon">&#11088;</div>
        <div><div class="page-title">تقييمات الاعضاء</div><div class="page-subtitle">شاركنا رأيك في السيرفر</div></div>
        <div class="page-line"></div>
      </div>
      <div class="ratings-layout">
        <div class="rating-form-card">
          <div class="rf-title">اضف تقييمك</div>
          <div class="form-stars" id="formStars">
            <span class="form-star" data-v="1">&#9733;</span>
            <span class="form-star" data-v="2">&#9733;</span>
            <span class="form-star" data-v="3">&#9733;</span>
            <span class="form-star" data-v="4">&#9733;</span>
            <span class="form-star" data-v="5">&#9733;</span>
          </div>
          <textarea class="form-textarea" id="ratingText" placeholder="اكتب رأيك هنا... (اختياري)" maxlength="300" style="min-height:75px"></textarea>
          <button class="btn-submit" id="submitRating" onclick="submitRating()">ارسال التقييم</button>
          <div id="submitMsg" style="display:none"></div>
        </div>
        <div class="ratings-grid" id="ratingsList"><div class="loading"><div class="spinner"></div> جار التحميل...</div></div>
      </div>
    </div>
  </div>

  <!-- PAGE 4: TWITTER -->
  <div class="page" id="page-4">
    <div class="page-inner">
      <div class="page-header">
        <div class="page-icon">&#128483;</div>
        <div><div class="page-title">تويتر Live Zone</div><div class="page-subtitle">تغريدات أعضاء السيرفر</div></div>
        <div class="page-line"></div>
      </div>
      <div class="twitter-layout">
        <div class="tweet-compose">
          <div class="compose-title">تغريدة جديدة</div>
          <div class="compose-row">
            <img class="compose-av" id="composeAv" src="https://cdn.discordapp.com/embed/avatars/0.png"/>
            <textarea class="compose-input" id="tweetInput" placeholder="ما الذي يدور في ذهنك؟" maxlength="280" oninput="updateCharCount()"></textarea>
          </div>
          <div class="compose-preview" id="composePreview">
            <img id="composePreviewImg" src=""/>
            <button class="compose-preview-rm" onclick="removeComposeImg()">&#10005;</button>
          </div>
          <div class="compose-footer">
            <div class="compose-actions">
              <label class="compose-img-btn" style="cursor:pointer">
                صورة
                <input type="file" accept="image/*" style="display:none" id="tweetImgInput" onchange="handleTweetImg(this)"/>
              </label>
            </div>
            <span class="char-count" id="charCount">280</span>
          </div>
          <button class="btn-primary" style="width:100%;margin-top:10px" onclick="postTweet()">تغريد</button>
          <div id="tweetMsg" style="font-size:.77rem;margin-top:7px"></div>
        </div>
        <div>
          <div class="tweet-feed" id="tweetFeed"><div class="loading"><div class="spinner"></div> جار التحميل...</div></div>
          <div id="loadMoreWrap" style="text-align:center;margin-top:12px;display:none">
            <button class="btn-ghost" onclick="loadTweets(true)">تحميل المزيد</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PAGE 5: RP POSITIONS -->
  <div class="page" id="page-5">
    <div class="page-inner">
      <div class="page-header">
        <div class="page-icon">&#127918;</div>
        <div><div class="page-title">مناصب الرول بلاي</div><div class="page-subtitle">الاعضاء حسب رتبهم</div></div>
        <div class="page-line"></div>
        <button class="btn-ghost" id="syncBtn" onclick="syncRp()" style="display:none">تحديث الرتب</button>
      </div>
      <div class="rp-grid" id="rpSections"><div class="loading"><div class="spinner"></div> جار التحميل...</div></div>
    </div>
  </div>

  <!-- PAGE 6: STAFF -->
  <div class="page" id="page-6">
    <div class="page-inner">
      <div class="page-header">
        <div class="page-icon">&#128081;</div>
        <div><div class="page-title">الفريق الاداري</div><div class="page-subtitle">المسؤولون عن ادارة السيرفر</div></div>
        <div class="page-line"></div>
      </div>
      <div id="staffContainer"><div class="loading"><div class="spinner"></div> جار التحميل...</div></div>
    </div>
  </div>

</div><!-- /pages-wrapper -->

<!-- BOTTOM NAV -->
<div class="page-nav">
  <button class="pnav-btn" id="prevBtn" onclick="goToPage(currentPage-1)" disabled>&#8594;</button>
  <div class="pnav-dots" id="pnavDots"></div>
  <span class="pnav-label" id="pnavLabel">الرئيسية</span>
  <button class="pnav-btn" id="nextBtn" onclick="goToPage(currentPage+1)">&#8592;</button>
</div>

<!-- PROFILE POPUP -->
<div class="popup-overlay" id="profileOverlay" onclick="closeProfile(event)">
  <div class="profile-popup" id="profilePopup">
    <div class="popup-banner" id="popupBanner">
      <div class="popup-banner-default" id="popupBannerDefault"></div>
      <button class="popup-close" onclick="closeProfileDirect()">&#10005;</button>
    </div>
    <div class="popup-av-wrap">
      <img class="popup-av" id="popupAv" src=""/>
    </div>
    <div class="popup-body">
      <div class="popup-name" id="popupName">...</div>
      <div class="popup-tag" id="popupTag">...</div>
      <div class="popup-badges" id="popupBadges"></div>
      <div class="sec-label" style="margin-bottom:6px">الرتب</div>
      <div class="popup-roles" id="popupRoles"></div>
      <div class="sec-label" style="margin-bottom:6px">الاحصائيات</div>
      <div class="popup-stats" id="popupStats"></div>
      <div class="popup-joined" id="popupJoined"></div>
    </div>
  </div>
</div>

<!-- IMAGE LIGHTBOX -->
<div class="lightbox" id="lightbox" onclick="document.getElementById('lightbox').classList.remove('open')">
  <img id="lightboxImg" src=""/>
</div>

<script>
const PAGE_NAMES = ['الرئيسية','الاعلانات','القوانين','التقييمات','تويتر','مناصب RP','الفريق'];
const TOTAL = 7;
let currentPage = 0;
let currentUser = null;
let selectedStars = 0;
let isAdmin = false;
let isAnimating = false;
let tweetPage = 0;
let tweetImgUrl = '';
let annImgUrl = '';

// ── BG PARTICLES ──────────────────────────────────────────────
(function(){
  const c = document.getElementById('bgParticles');
  for(let i=0;i<20;i++){
    const p = document.createElement('div');
    p.className = 'particle';
    const s = Math.random()*2.5+1;
    p.style.cssText = `width:${s}px;height:${s}px;left:${Math.random()*100}%;animation-duration:${Math.random()*16+10}s;animation-delay:${Math.random()*12}s;opacity:${Math.random()*0.3+0.06}`;
    c.appendChild(p);
  }
})();

// ── BUILD DOTS ────────────────────────────────────────────────
(function(){
  const d = document.getElementById('pnavDots');
  for(let i=0;i<TOTAL;i++){
    const dot = document.createElement('div');
    dot.className = 'pnav-dot' + (i===0?' active':'');
    dot.onclick = () => goToPage(i);
    d.appendChild(dot);
  }
})();

// ── PAGE NAV ──────────────────────────────────────────────────
function goToPage(idx){
  if(idx<0||idx>=TOTAL||idx===currentPage||isAnimating) return;
  isAnimating = true;
  const old = document.getElementById('page-'+currentPage);
  const nw  = document.getElementById('page-'+idx);
  old.classList.remove('active');
  old.classList.add('exit');
  setTimeout(()=>{ old.classList.remove('exit'); isAnimating=false; }, 400);
  nw.classList.add('active');
  nw.scrollTop = 0;
  currentPage = idx;
  updateNavState();
}
function updateNavState(){
  document.querySelectorAll('.nav-pill').forEach((p,i)=>p.classList.toggle('active',i===currentPage));
  document.querySelectorAll('.pnav-dot').forEach((d,i)=>d.classList.toggle('active',i===currentPage));
  document.getElementById('pnavLabel').textContent = PAGE_NAMES[currentPage];
  document.getElementById('prevBtn').disabled = currentPage===0;
  document.getElementById('nextBtn').disabled = currentPage===TOTAL-1;
}
function toggleMobileNav(){ document.getElementById('mobileNav').classList.toggle('open'); }
document.addEventListener('keydown', e=>{
  if(e.key==='ArrowLeft') goToPage(currentPage+1);
  if(e.key==='ArrowRight') goToPage(currentPage-1);
});

// ── STARS ─────────────────────────────────────────────────────
document.querySelectorAll('.form-star').forEach(s=>{
  s.addEventListener('mouseover', ()=>hlStars(+s.dataset.v));
  s.addEventListener('mouseout',  ()=>hlStars(selectedStars));
  s.addEventListener('click',     ()=>{ selectedStars=+s.dataset.v; hlStars(selectedStars); });
});
function hlStars(n){ document.querySelectorAll('.form-star').forEach((s,i)=>{ s.style.color = i<n?'#ffc832':'var(--muted2)'; }); }

// ── PROFILE POPUP ─────────────────────────────────────────────
async function openProfile(userId){
  document.getElementById('profileOverlay').classList.add('open');
  document.getElementById('popupName').textContent = '...';
  document.getElementById('popupRoles').innerHTML = '<div class="loading"><div class="spinner"></div></div>';
  document.getElementById('popupStats').innerHTML = '';
  document.getElementById('popupBadges').innerHTML = '';
  document.getElementById('popupJoined').textContent = '';
  document.getElementById('popupBannerDefault').style.display = 'block';
  const bi = document.getElementById('popupBanner').querySelector('img');
  if(bi) bi.remove();
  try{
    const d = await (await fetch('/api/profile/'+userId)).json();
    document.getElementById('popupAv').src = d.avatar;
    document.getElementById('popupName').textContent = d.nick;
    document.getElementById('popupTag').textContent = '@'+d.username;

    // Banner
    const banner = document.getElementById('popupBanner');
    if(d.banner){
      document.getElementById('popupBannerDefault').style.display='none';
      const img = document.createElement('img');
      img.className='popup-banner-img'; img.src=d.banner;
      banner.insertBefore(img, banner.querySelector('.popup-close'));
    } else if(d.accentColor){
      document.getElementById('popupBannerDefault').style.background = `linear-gradient(135deg, ${d.accentColor}44, ${d.accentColor}22, rgba(0,200,255,0.15))`;
    }

    // Badges
    const badges = [];
    if(d.premiumType) badges.push('<span class="badge badge-gold">Nitro</span>');
    if(d.topRole) badges.push(`<span class="badge badge-sky" style="border-color:${d.topRole.color}33;color:${d.topRole.color}">${esc(d.topRole.name)}</span>`);
    document.getElementById('popupBadges').innerHTML = badges.join('');

    // Roles
    document.getElementById('popupRoles').innerHTML = d.roles.slice(0,6).map(r=>`
      <div class="role-tag"><div class="role-dot" style="background:${r.color}"></div>${esc(r.name)}</div>`).join('') || '<span style="color:var(--muted);font-size:.78rem">لا توجد رتب</span>';

    // Stats
    const joined = d.joinedAt ? Math.floor((Date.now()-new Date(d.joinedAt))/86400000) : '—';
    const created = Math.floor((Date.now()-new Date(d.accountCreatedAt))/86400000);
    document.getElementById('popupStats').innerHTML = `
      <div class="popup-stat"><div class="popup-stat-val">${joined}</div><div class="popup-stat-lbl">يوم بالسيرفر</div></div>
      <div class="popup-stat"><div class="popup-stat-val">${d.tweetCount}</div><div class="popup-stat-lbl">تغريدة</div></div>
      <div class="popup-stat"><div class="popup-stat-val">${created}</div><div class="popup-stat-lbl">يوم بـ Discord</div></div>`;

    // Joined
    if(d.joinedAt){
      document.getElementById('popupJoined').textContent = 'انضم في ' + new Date(d.joinedAt).toLocaleDateString('ar-SA',{year:'numeric',month:'long',day:'numeric'});
    }
  } catch(e){
    document.getElementById('popupName').textContent = 'تعذر التحميل';
    document.getElementById('popupRoles').innerHTML = '';
  }
}
function openMyProfile(){ if(currentUser) openProfile(currentUser.id); }
function closeProfile(e){ if(e.target===document.getElementById('profileOverlay')) closeProfileDirect(); }
function closeProfileDirect(){ document.getElementById('profileOverlay').classList.remove('open'); }

// ── RATINGS ───────────────────────────────────────────────────
async function submitRating(){
  if(!selectedStars){showMsg('اختر عدد النجوم',false);return;}
  if(!currentUser){showMsg('يجب تسجيل الدخول',false);return;}
  const text = document.getElementById('ratingText').value.trim();
  const btn  = document.getElementById('submitRating');
  btn.disabled=true; btn.textContent='جار الارسال...';
  const av = currentUser.avatar?`https://cdn.discordapp.com/avatars/${currentUser.id}/${currentUser.avatar}.png`:`https://cdn.discordapp.com/embed/avatars/0.png`;
  const WEBHOOK = 'https://discord.com/api/webhooks/1477005400049058006/JzP_DJiR5HkXA3jwbsE2lwVJGsgavZLLUbxZBOVizEqSob5YMqLQ-po56nhezts4M5Uy';
  try{
    const stars = '★'.repeat(selectedStars)+'☆'.repeat(5-selectedStars);
    await fetch(WEBHOOK,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({embeds:[{title:'تقييم جديد '+stars,description:text||'بدون تعليق',color:0x00c8ff,author:{name:currentUser.global_name||currentUser.username,icon_url:av},timestamp:new Date().toISOString()}]})});
    await fetch('/api/ratings',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({stars:selectedStars,text,userId:currentUser.id,username:currentUser.global_name||currentUser.username,avatar:av})});
    showMsg('تم ارسال تقييمك بنجاح',true);
    selectedStars=0;hlStars(0);document.getElementById('ratingText').value='';
    loadRatings();
  } catch(e){showMsg('حدث خطأ',false);}
  btn.disabled=false;btn.textContent='ارسال التقييم';
}
function showMsg(msg,ok){
  const el=document.getElementById('submitMsg');
  el.style.display='block';el.className='submit-msg '+(ok?'msg-ok':'msg-err');el.textContent=msg;
  setTimeout(()=>el.style.display='none',4000);
}
async function loadRatings(){
  try{
    const data = await(await fetch('/api/ratings')).json();
    const list = document.getElementById('ratingsList');
    if(!data.length){list.innerHTML='<div class="no-data">لا توجد تقييمات بعد</div>';return;}
    list.innerHTML = data.slice(0,12).map(r=>`
      <div class="rating-card">
        ${isAdmin?`<div class="ann-del"><button class="btn-danger" onclick="delRating('${r._id}',this.closest('.rating-card'))">حذف</button></div>`:''}
        <div class="rating-hdr">
          <img class="rating-av" src="${r.avatar||defAv()}" onerror="this.src='${defAv()}'" onclick="openProfile('${r.userId}')"/>
          <div><div class="rating-name">${esc(r.username)}</div><div class="rating-date">${fmtDate(r.createdAt)}</div></div>
        </div>
        <div class="stars-row">${'<span class="star-f">&#9733;</span>'.repeat(r.stars)}${'<span class="star-e">&#9733;</span>'.repeat(5-r.stars)}</div>
        <div class="rating-text">${esc(r.text||'بدون تعليق')}</div>
      </div>`).join('');
  } catch(e){document.getElementById('ratingsList').innerHTML='<div class="no-data">تعذر التحميل</div>';}
}
async function delRating(id,el){
  if(!confirm('حذف هذا التقييم؟'))return;
  if((await fetch('/api/ratings/'+id,{method:'DELETE'})).ok) el.remove();
}

// ── ANNOUNCEMENTS ─────────────────────────────────────────────
async function handleAnnImage(input){
  if(!input.files[0]) return;
  const url = await uploadImage(input.files[0]);
  if(url){ annImgUrl=url; const p=document.getElementById('annImagePreview'); p.src=url; p.style.display='block'; document.getElementById('annImageLabel').textContent='الصورة مرفقة'; }
}
async function uploadImage(file){
  const fd = new FormData(); fd.append('image',file);
  try{
    const r = await fetch('/api/upload',{method:'POST',body:fd});
    const d = await r.json();
    return d.url||'';
  }catch{return '';}
}
async function postAnnouncement(){
  const icon    = document.getElementById('annIcon').value.trim();
  const title   = document.getElementById('annTitle').value.trim();
  const content = document.getElementById('annContent').value.trim();
  const msg     = document.getElementById('annMsg');
  if(!title||!content){msg.style.color='var(--red)';msg.textContent='ادخل العنوان والمحتوى';return;}
  const res = await fetch('/api/announcements',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({title,content,icon,image:annImgUrl})});
  if(res.ok){
    msg.style.color='var(--green)';msg.textContent='تم النشر';
    ['annTitle','annContent','annIcon'].forEach(id=>document.getElementById(id).value='');
    document.getElementById('annImagePreview').style.display='none';
    document.getElementById('annImageLabel').textContent='ارفاق صورة (اختياري)';
    annImgUrl='';
    loadAnnouncements();
    setTimeout(()=>msg.textContent='',3000);
  } else { msg.style.color='var(--red)'; msg.textContent='خطأ في النشر'; }
}
async function loadAnnouncements(){
  try{
    const data = await(await fetch('/api/announcements')).json();
    const list = document.getElementById('announcementsList');
    if(!data.length){list.innerHTML='<div class="no-data">لا توجد اعلانات حالياً</div>';return;}
    list.innerHTML = data.map(a=>`
      <div class="ann-item">
        ${isAdmin?`<div class="ann-del"><button class="btn-danger" onclick="delAnn('${a._id}',this.closest('.ann-item'))">حذف</button></div>`:''}
        <div class="ann-header">
          ${a.icon?`<div class="ann-icon-wrap">${esc(a.icon)}</div>`:''}
          <div><div class="ann-title">${esc(a.title)}</div></div>
        </div>
        <div class="ann-text">${esc(a.content)}</div>
        ${a.image?`<img class="ann-img" src="${a.image}" onclick="openLightbox(this.src)" loading="lazy"/>`:''}
        <div class="ann-date">${fmtDate(a.createdAt)}</div>
      </div>`).join('');
  } catch(e){document.getElementById('announcementsList').innerHTML='<div class="no-data">تعذر التحميل</div>';}
}
async function delAnn(id,el){
  if(!confirm('حذف هذا الاعلان؟'))return;
  if((await fetch('/api/announcements/'+id,{method:'DELETE'})).ok) el.remove();
}

// ── TWITTER ───────────────────────────────────────────────────
function updateCharCount(){
  const len = document.getElementById('tweetInput').value.length;
  const el = document.getElementById('charCount');
  el.textContent = 280-len;
  el.style.color = len>250?'var(--red)':'var(--muted)';
}
async function handleTweetImg(input){
  if(!input.files[0]) return;
  const url = await uploadImage(input.files[0]);
  if(url){
    tweetImgUrl=url;
    document.getElementById('composePreviewImg').src=url;
    document.getElementById('composePreview').style.display='block';
  }
  input.value='';
}
function removeComposeImg(){
  tweetImgUrl='';
  document.getElementById('composePreview').style.display='none';
  document.getElementById('composePreviewImg').src='';
}
async function postTweet(){
  const content = document.getElementById('tweetInput').value.trim();
  if(!content){return;}
  const res = await fetch('/api/tweets',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({content,image:tweetImgUrl})});
  const msg = document.getElementById('tweetMsg');
  if(res.ok){
    document.getElementById('tweetInput').value='';
    updateCharCount();
    removeComposeImg();
    msg.style.color='var(--green)';msg.textContent='تم نشر التغريدة';
    setTimeout(()=>msg.textContent='',3000);
    tweetPage=0;
    await loadTweets(false);
  } else {
    const d = await res.json();
    if(d.error==='no_tweet_permission'){
      msg.style.color='var(--red)';msg.textContent='ليس لديك صلاحية التغريد';
    } else {
      msg.style.color='var(--red)';msg.textContent='حدث خطأ';
    }
  }
}
async function loadTweets(append=false){
  if(!append){ tweetPage=0; document.getElementById('tweetFeed').innerHTML='<div class="loading"><div class="spinner"></div> جار التحميل...</div>'; }
  try{
    const tweets = await(await fetch('/api/tweets?page='+tweetPage)).json();
    const feed = document.getElementById('tweetFeed');
    if(!append) feed.innerHTML='';
    if(!tweets.length && !append){ feed.innerHTML='<div class="no-data">لا توجد تغريدات بعد — كن الاول</div>'; document.getElementById('loadMoreWrap').style.display='none'; return; }
    tweets.forEach(t => feed.innerHTML += buildTweetHTML(t));
    document.getElementById('loadMoreWrap').style.display = tweets.length>=20?'block':'none';
    tweetPage++;
  } catch(e){document.getElementById('tweetFeed').innerHTML='<div class="no-data">تعذر التحميل</div>';}
}
function buildTweetHTML(t){
  const uid = currentUser?.id;
  const liked    = (t.likes||[]).includes(uid);
  const reposted = (t.reposts||[]).includes(uid);
  const isOwner  = t.userId===uid;
  const totalLikes   = (t.likes||[]).length;
  const totalReposts = (t.reposts||[]).length;
  const totalComments= t.comments||0;
  return `<div class="tweet-card" id="tweet-${t._id}">
    ${(isOwner||isAdmin)?`<div class="tweet-del-btn" style="display:block"><button class="btn-danger" onclick="delTweet('${t._id}')">حذف</button></div>`:''}
    <div class="tweet-hdr">
      <img class="tweet-av" src="${t.avatar||defAv()}" onerror="this.src='${defAv()}'" onclick="openProfile('${t.userId}')"/>
      <div>
        <div class="tweet-name">${esc(t.username)}</div>
        <div class="tweet-handle">@${esc(t.handle)}</div>
      </div>
      <span class="tweet-time">${timeAgo(t.createdAt)}</span>
    </div>
    <div class="tweet-content">${esc(t.content)}</div>
    ${t.image?`<img class="tweet-img" src="${t.image}" onclick="openLightbox(this.src)" loading="lazy"/>`:''}
    <div class="tweet-actions">
      <button class="tweet-action${liked?' liked':''}" onclick="toggleLike('${t._id}',this)">
        ${liked?'&#10084;':'&#9825;'} <span>${totalLikes}</span>
      </button>
      <button class="tweet-action${reposted?' reposted':''}" onclick="toggleRepost('${t._id}',this)">
        &#8635; <span>${totalReposts}</span>
      </button>
      <button class="tweet-action" onclick="toggleComments('${t._id}',this)">
        &#128172; <span>${totalComments}</span>
      </button>
    </div>
    <div class="comments-section" id="cs-${t._id}">
      <div class="comment-compose">
        <img class="comment-av" src="${currentUser?.avatar?`https://cdn.discordapp.com/avatars/${currentUser.id}/${currentUser.avatar}.png?size=32`:defAv()}" onerror="this.src='${defAv()}'"/>
        <div style="flex:1">
          <textarea class="comment-input" id="ci-${t._id}" placeholder="اكتب تعليقك..." rows="2"></textarea>
          <button class="btn-comment" onclick="postComment('${t._id}')">ارسال</button>
        </div>
      </div>
      <div class="comment-list" id="cl-${t._id}"></div>
    </div>
  </div>`;
}
async function toggleLike(id, btn){
  const res = await fetch('/api/tweets/'+id+'/like',{method:'POST'});
  if(!res.ok) return;
  const d = await res.json();
  btn.classList.toggle('liked', d.liked);
  btn.innerHTML = `${d.liked?'&#10084;':'&#9825;'} <span>${d.count}</span>`;
}
async function toggleRepost(id, btn){
  const res = await fetch('/api/tweets/'+id+'/repost',{method:'POST'});
  if(!res.ok) return;
  const d = await res.json();
  btn.classList.toggle('reposted', d.reposted);
  btn.innerHTML = `&#8635; <span>${d.count}</span>`;
}
async function toggleComments(tweetId, btn){
  const cs = document.getElementById('cs-'+tweetId);
  const open = cs.classList.toggle('open');
  if(open) loadComments(tweetId);
}
async function loadComments(tweetId){
  const list = document.getElementById('cl-'+tweetId);
  list.innerHTML = '<div class="loading" style="padding:10px"><div class="spinner"></div></div>';
  try{
    const comments = await(await fetch('/api/tweets/'+tweetId+'/comments')).json();
    if(!comments.length){list.innerHTML='<div style="font-size:.77rem;color:var(--muted);padding:6px">لا توجد تعليقات بعد</div>';return;}
    list.innerHTML = comments.map(c=>`
      <div class="comment-item" id="comment-${c._id}">
        <img class="comment-av" src="${c.avatar||defAv()}" onerror="this.src='${defAv()}'" onclick="openProfile('${c.userId}')"/>
        <div class="comment-body">
          <div class="comment-name">${esc(c.username)} <span style="color:var(--muted2);font-size:.65rem;font-weight:400">${timeAgo(c.createdAt)}</span></div>
          <div class="comment-text">${esc(c.content)}</div>
        </div>
        ${(isAdmin||c.userId===currentUser?.id)?`<button class="btn-danger" style="flex-shrink:0;padding:3px 8px;font-size:.65rem" onclick="delComment('${tweetId}','${c._id}')">×</button>`:''}
      </div>`).join('');
  } catch(e){list.innerHTML='';}
}
async function postComment(tweetId){
  const input = document.getElementById('ci-'+tweetId);
  const content = input.value.trim();
  if(!content) return;
  const res = await fetch('/api/tweets/'+tweetId+'/comments',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({content})});
  if(res.ok){
    input.value='';
    await loadComments(tweetId);
    // Update comment count
    const tweet = document.getElementById('tweet-'+tweetId);
    if(tweet){
      const cmtBtn = tweet.querySelector('.tweet-action:nth-child(3) span');
      if(cmtBtn) cmtBtn.textContent = parseInt(cmtBtn.textContent||0)+1;
    }
  }
}
async function delComment(tweetId, commentId){
  if(!confirm('حذف هذا التعليق؟')) return;
  const res = await fetch(`/api/tweets/${tweetId}/comments/${commentId}`,{method:'DELETE'});
  if(res.ok){
    document.getElementById('comment-'+commentId)?.remove();
    const tweet = document.getElementById('tweet-'+tweetId);
    if(tweet){
      const cmtBtn = tweet.querySelector('.tweet-action:nth-child(3) span');
      if(cmtBtn) cmtBtn.textContent = Math.max(0,parseInt(cmtBtn.textContent||0)-1);
    }
  }
}
async function delTweet(id){
  if(!confirm('حذف هذه التغريدة؟')) return;
  const res = await fetch('/api/tweets/'+id,{method:'DELETE'});
  if(res.ok) document.getElementById('tweet-'+id)?.remove();
}

// ── RP MEMBERS ────────────────────────────────────────────────
const RP_ORDER = ['1471551621337972938','1474275740756480389','1474276207225733170','1471575274222125236','1471908537331617976','1471915477063176467','1471916760826511524','1472606415892774972'];
async function loadRpMembers(){
  try{
    const {data,updatedAt,roles} = await(await fetch('/api/rp-members')).json();
    const c = document.getElementById('rpSections');
    c.innerHTML = RP_ORDER.map(rid=>{
      const info = roles[rid]; if(!info) return '';
      const members = data[rid]||[];
      return `<div class="rp-group">
        <div class="rp-gh">
          <div style="width:12px;height:12px;border-radius:50%;background:${info.color};flex-shrink:0"></div>
          <span class="rp-gn" style="color:${info.color}">${info.name}</span>
          <span class="rp-gc">${members.length} عضو</span>
        </div>
        <div class="rp-members-grid">
          ${members.length?members.map(m=>`
            <div class="rp-member" onclick="openProfile('${m.id}')">
              <img class="rp-av" src="${m.avatar}" onerror="this.src='${defAv()}'" style="border-color:${info.color}44"/>
              <div class="rp-nm">${esc(m.name)}</div>
            </div>`).join(''):'<div class="rp-empty">لا يوجد اعضاء</div>'}
        </div>
        ${updatedAt?`<div class="rp-footer"><span>اخر تحديث: ${fmtDate(updatedAt)}</span><span>يتحدث أسبوعياً</span></div>`:''}
      </div>`;
    }).join('');
  } catch(e){document.getElementById('rpSections').innerHTML='<div class="no-data">تعذر التحميل</div>';}
}
async function syncRp(){
  const btn=document.getElementById('syncBtn');
  btn.disabled=true;btn.textContent='جار التحديث...';
  try{
    if((await fetch('/api/rp-sync',{method:'POST'})).ok){ await loadRpMembers(); btn.textContent='تم التحديث'; }
    else btn.textContent='خطأ';
  }catch{btn.textContent='خطأ';}
  setTimeout(()=>{ btn.textContent='تحديث الرتب';btn.disabled=false; },2500);
}

// ── STAFF ─────────────────────────────────────────────────────
async function loadStaff(){
  try{
    const staff = await(await fetch('/api/staff')).json();
    const c = document.getElementById('staffContainer');
    if(!staff.length){c.innerHTML='<div class="no-data">لا يوجد فريق</div>';return;}
    // Group by tier
    const tiers = {};
    staff.forEach(m=>{
      if(!tiers[m.tierName]) tiers[m.tierName] = { color:m.tierColor, members:[] };
      tiers[m.tierName].members.push(m);
    });
    c.innerHTML = Object.entries(tiers).map(([name,tier])=>`
      <div class="staff-tier">
        <div class="tier-header">
          <div class="tier-dot" style="background:${tier.color}"></div>
          <div class="tier-name" style="color:${tier.color}">${esc(name)}</div>
          <div class="tier-line" style="background:linear-gradient(90deg,${tier.color}33,transparent)"></div>
        </div>
        <div class="staff-grid">
          ${tier.members.map(m=>`
            <div class="staff-card" onclick="openProfile('${m.id}')">
              <img class="staff-av" src="${m.avatar}" onerror="this.src='${defAv()}'" style="border-color:${tier.color}44"/>
              <div class="staff-name">${esc(m.name)}</div>
              <div class="staff-role" style="color:${tier.color}">${esc(m.tierName)}</div>
            </div>`).join('')}
        </div>
      </div>`).join('');
  } catch(e){document.getElementById('staffContainer').innerHTML='<div class="no-data">تعذر التحميل</div>';}
}

// ── USER LOAD ─────────────────────────────────────────────────
async function loadUser(){
  try{
    const res = await fetch('/auth/user');
    if(!res.ok){ window.location.href='/'; return; }
    const u = await res.json();
    currentUser = u;
    const av = u.avatar?`https://cdn.discordapp.com/avatars/${u.id}/${u.avatar}.png?size=128`:defAv(u.id);
    document.getElementById('navAvatar').src = av;
    document.getElementById('navName').textContent = u.global_name||u.username;
    document.getElementById('profileAvatar').src = av;
    document.getElementById('composeAv').src = av;
    document.getElementById('profileName').textContent = u.global_name||u.username;
    document.getElementById('profileTag').textContent = '@'+u.username;
    document.getElementById('statId').textContent = u.id.slice(-4);
    document.getElementById('statType').textContent = u.premium_type?'Nitro':'عادي';
    const ms = Number((BigInt(u.id)>>22n)+1420070400000n);
    document.getElementById('statDays').textContent = Math.floor((Date.now()-ms)/86400000);
    document.getElementById('memberSince').textContent = 'عضو منذ ' + new Date(ms).toLocaleDateString('ar-SA',{year:'numeric',month:'long'});
    document.getElementById('profileBadges').innerHTML = '<span class="badge badge-sky">عضو</span>';
    loadMember(u.id);
  } catch(e){ window.location.href='/'; }
}
async function loadMember(id){
  try{
    const d = await(await fetch('/api/member/'+id)).json();
    document.getElementById('rolesList').innerHTML = d.roles?.length
      ? d.roles.slice(0,8).map(r=>`<div class="role-tag"><div class="role-dot" style="background:${r.color||'#5865f2'}"></div>${esc(r.name)}</div>`).join('')
      : '<div class="role-tag"><div class="role-dot" style="background:#5865f2"></div>@everyone</div>';
    if(d.isWebAdmin||d.isAdmin){
      isAdmin=true;
      document.getElementById('profileBadges').innerHTML='<span class="badge badge-red">ادمن الموقع</span>'+document.getElementById('profileBadges').innerHTML;
      document.getElementById('adminBadgeNav').style.display='';
      if(d.isWebAdmin){ document.getElementById('adminAnnPanel').classList.add('visible'); document.getElementById('syncBtn').style.display=''; }
    }
  }catch{
    document.getElementById('rolesList').innerHTML='<div class="role-tag"><div class="role-dot" style="background:#5865f2"></div>@everyone</div>';
  }
}
async function loadGuild(){
  try{
    const d = await(await fetch('/api/guild')).json();
    if(d.approximate_member_count) document.getElementById('memberCount').textContent=d.approximate_member_count.toLocaleString('ar');
    if(d.approximate_presence_count) document.getElementById('onlineCount').textContent=d.approximate_presence_count.toLocaleString('ar');
  }catch{}
}

// ── RULES TABS ────────────────────────────────────────────────
function switchTab(name){
  document.querySelectorAll('.rules-tab').forEach((t,i)=>{ const tabs=['discord','rp','hamburg']; t.classList.toggle('active',tabs[i]===name); });
  document.querySelectorAll('.rules-panel').forEach(p=>{ p.classList.toggle('active',p.id==='tab-'+name); });
}

// ── LIGHTBOX ──────────────────────────────────────────────────
function openLightbox(src){
  document.getElementById('lightboxImg').src=src;
  document.getElementById('lightbox').classList.add('open');
}

// ── HELPERS ───────────────────────────────────────────────────
function defAv(id){
  if(!id) return 'https://cdn.discordapp.com/embed/avatars/0.png';
  try{ return `https://cdn.discordapp.com/embed/avatars/${Number(BigInt(id)%5n)}.png`; }
  catch{ return 'https://cdn.discordapp.com/embed/avatars/0.png'; }
}
function esc(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function fmtDate(d){ return new Date(d).toLocaleDateString('ar-SA',{year:'numeric',month:'short',day:'numeric'}); }
function timeAgo(d){
  const diff = Date.now()-new Date(d).getTime();
  const m = Math.floor(diff/60000);
  if(m<1) return 'الآن';
  if(m<60) return `${m} د`;
  const h = Math.floor(m/60);
  if(h<24) return `${h} س`;
  const days = Math.floor(h/24);
  if(days<30) return `${days} يوم`;
  return fmtDate(d);
}

// ── INIT ──────────────────────────────────────────────────────
loadUser();
loadGuild();
loadRatings();
loadAnnouncements();
loadTweets();
loadRpMembers();
loadStaff();
</script>
</body>
</html>
